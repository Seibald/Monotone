<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Jeu en cours</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const socket = io();

            const room = "{{ room }}";
            socket.emit('join', { room: room, hero: "{{ session.get('hero', 'Héros 1') }}" });

            socket.on('start_game', (game) => {
                updateGame(game);
            });

            socket.on('update_game', (game) => {
                updateGame(game);
            });

            const updateGame = (game) => {
                // Update the game state on the page
                document.getElementById('turn').innerText = `Tour ${game.turn}`;
                document.getElementById('currentPlayer').innerText = `C'est au ${game.current_player == 'player1' ? 'Joueur 1' : 'Joueur 2'} de jouer.`;
                document.getElementById('player1').innerText = `Joueur 1 - PV: ${game.player1.pv} - Blasées: ${game.player1.blase_count} - Dégâts de Réveil: ${game.player1.degats_de_reveil}`;
                document.getElementById('player2').innerText = `Joueur 2 - PV: ${game.player2.pv} - Blasées: ${game.player2.blase_count} - Dégâts de Réveil: ${game.player2.degats_de_reveil}`;
                if (game.last_card) {
                    document.getElementById('lastCard').innerHTML = `<img src="{{ url_for('static', filename='images/' + game.last_card.replace(' ', '_') + '.png') }}" alt="${game.last_card}">`;
                }
            };

            document.getElementById('playCard').addEventListener('submit', (e) => {
                e.preventDefault();
                const card = document.querySelector('input[name="card"]:checked').value;
                const target = document.querySelector('input[name="target"]:checked') ? document.querySelector('input[name="target"]:checked').value : null;
                socket.emit('play_card', { room: room, card: card, target: target });
            });
        });
    </script>
</head>
<body>
    <h1 id="turn">Tour 1</h1>
    <h2 id="currentPlayer">C'est au Joueur 1 de jouer.</h2>
    <h3>État des joueurs :</h3>
    <p id="player1">Joueur 1 - PV: 15 - Blasées: 0 - Dégâts de Réveil: 0</p>
    <p id="player2">Joueur 2 - PV: 15 - Blasées: 0 - Dégâts de Réveil: 0</p>
    <h3 id="lastCard">Carte piochée :</h3>
    <h3>Choisissez une action :</h3>
    <form id="playCard">
        <input type="radio" name="card" value="eveillez" required> Éveiller<br>
        <input type="radio" name="card" value="blasez" required> Blaser<br>
        <div id="targetOptions" style="display: none;">
            <p>Choisissez une cible :</p>
            <input type="radio" name="target" value="self" required> Vous-même<br>
            <input type="radio" name="target" value="opponent" required> L'adversaire<br>
        </div>
        <button type="submit">Valider</button>
    </form>
</body>
</html>